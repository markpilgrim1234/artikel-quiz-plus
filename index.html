<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Welcher Artikel? ‚Äì Quiz</title>

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" href="icon.png">
  <meta name="theme-color" content="#ffffff">

  <style>
    :root{
      /* Same colors as your game buttons */
      --der: #000000;
      --die: #e94e3c;
      --das: #f4c542;

      --bg: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --card: #ffffff;
      --border: #e5e7eb;
      --shadow: 0 10px 25px rgba(0,0,0,0.06);
      --radius: 14px;

      --green: #21bf73;
    }

    *{ box-sizing: border-box; }

    body{
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.55;
      overflow-x: hidden;
    }

    /* Top bar */
    header{
      position: sticky;
      top: 0;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
      z-index: 20;
    }

    .topbar{
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .brand{
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .brand img{
      width: 34px;
      height: 34px;
      border-radius: 10px;
    }

    .titles{
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .titles h1{
      margin: 0;
      font-size: 1.05rem;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .titles p{
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Pill button (like "Zum Spiel zur√ºckkehren") */
    .btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      text-decoration: none;
      font-weight: 700;
      cursor: pointer;
      transition: transform .05s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.04);
      white-space: nowrap;
    }
    .btn:active{ transform: translateY(1px); }
    .btn:hover{
      border-color: #d1d5db;
      background: #fafafa;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    /* Smaller pill button (Pause) */
    .btnSmall{
      padding: 7px 10px;
      font-size: 0.9rem;
      border-radius: 999px;
      box-shadow: none;
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 16px 28px;
    }

    .grid{
      display: grid;
      gap: 14px;
    }

    @media (min-width: 980px){
      .grid{
        grid-template-columns: 1.25fr 0.9fr;
        align-items: start;
      }
    }

    .hero{
      margin: 18px 0 14px;
      padding: 18px 18px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
      box-shadow: var(--shadow);
    }
    .heroTitle{
      margin: 0 0 6px;
      font-size: 1.35rem;
      letter-spacing: 0.2px;
    }
    .heroSub{
      margin: 0;
      color: var(--muted);
      font-size: 1rem;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .cardHead{
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .cardHeadLeft{
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .cardHeadLeft .title{
      margin: 0;
      font-size: 1.05rem;
      font-weight: 800;
      color: var(--text);
    }

    .cardHeadLeft .subtitle{
      margin: 0;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .scoreRow{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.04);
    }

    #score{
      font-weight: 800;
      font-size: 0.98rem;
      color: #333;
      white-space: nowrap;
    }

    .miniBtn{
      border: 1px solid var(--border);
      background: #fff;
      color: #444;
      font-weight: 700;
      font-size: 0.85rem;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
    }
    .miniBtn:hover{
      border-color: #d1d5db;
      background: #fafafa;
    }

    .content{
      padding: 16px;
    }

    .word{
      font-size: 2.2rem;
      text-align: center;
      font-weight: 900;
      margin: 10px 0 14px;
      letter-spacing: 0.2px;
    }

    .options{
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 6px;
    }

    .options button{
      flex: 1;
      padding: 1.1rem;
      font-size: 1.5rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: #fff;
      font-weight: 900;
      box-shadow: 0 10px 18px rgba(0,0,0,0.08);
      transition: transform .05s ease, filter .2s ease, opacity .2s ease;
    }
    .options button:active{ transform: translateY(1px); }
    .options button:hover{ filter: brightness(0.98); }

    .options button:nth-child(1){ background: var(--der); }
    .options button:nth-child(2){ background: var(--die); }
    .options button:nth-child(3){ background: var(--das); color: #111; }

    .options button:disabled{
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .result{
      margin-top: 14px;
      font-weight: 900;
      text-align: center;
      font-size: 1.25rem;
      min-height: 1.6em;
    }

    .extra{
      margin-top: 10px;
      padding: 12px;
      border-radius: 12px;
      border: 1px dashed #d1d5db;
      background: #fbfbfb;
      text-align: center;
      color: #374151;
      font-size: 1.05rem;
      min-height: 1.2em;
    }

    .countdownRow{
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      min-height: 40px;
    }

    #countdown{
      font-weight: 800;
      color: var(--muted);
      font-size: 0.95rem;
      text-align: center;
    }

    /* History table */
    .historyWrap{
      max-height: 520px;
      overflow: auto;
      padding: 0 16px 16px;
    }

    table{
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }
    th, td{
      padding: 10px 8px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }
    th{
      text-align: left;
      color: #374151;
      font-weight: 900;
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 2;
    }
    td.status{
      width: 56px;
      text-align: center;
      font-weight: 900;
      white-space: nowrap;
    }
    .ok{ color: #0f766e; }     /* teal-ish */
    .bad{ color: #b91c1c; }    /* red-ish */
    .mutedCell{ color: var(--muted); }

    /* Splash */
    #splash{
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #splash h1{
      font-size: 2rem;
      margin: 0 0 1rem;
    }
    #splash img{
      width: 260px;
      height: 260px;
    }

    footer{
      margin-top: 18px;
      text-align: center;
      color: #888;
      font-size: 0.85rem;
    }
  </style>
</head>

<body>
  <!-- Splash -->
  <div id="splash">
    <h1>Welcher Artikel?</h1>
    <img src="icon.png" alt="Logo">
  </div>

  <!-- Top bar -->
  <header>
    <div class="topbar">
      <div class="brand">
        <img src="icon.png" alt="Logo">
        <div class="titles">
          <h1>Quiz</h1>
          <p>Welcher Artikel? ‚Äì A2</p>
        </div>
      </div>

      <div style="display:flex; gap:10px; align-items:center;">
        <button id="pauseBtn" class="btn btnSmall" type="button">Pause</button>
        <a class="btn" href="artikelregeln.html" aria-label="Artikelregeln √∂ffnen">Artikelregeln</a>
      </div>
    </div>
  </header>

  <div class="wrap">
    <section class="hero">
      <h2 class="heroTitle">W√§hle den richtigen Artikel</h2>
      <p class="heroSub">Tippe auf <strong>der</strong>, <strong>die</strong> oder <strong>das</strong>. Danach geht es automatisch weiter (2 Sekunden).</p>
    </section>

    <div class="grid">
      <!-- LEFT: Quiz -->
      <section class="card">
        <div class="cardHead">
          <div class="cardHeadLeft">
            <p class="title">Spiel</p>
            <p class="subtitle">Trainiere der / die / das</p>
          </div>

          <div class="scoreRow" aria-label="Punktestand">
            <div id="score">‚úÖ Richtig: 0‚ÄÉ‚ùå Falsch: 0</div>
            <button id="resetBtn" class="miniBtn" type="button" title="Reset game">Reset</button>
          </div>
        </div>

        <div class="content">
          <div class="word" id="word">Lade W√∂rter...</div>

          <div class="options" id="options"></div>

          <div class="result" id="result"></div>

          <div class="extra" id="extra"></div>

          <div class="countdownRow">
            <div id="countdown"></div>
          </div>
        </div>
      </section>

      <!-- RIGHT: History -->
      <section class="card">
        <div class="cardHead">
          <div class="cardHeadLeft">
            <p class="title">Antworten</p>
            <p class="subtitle">Du hast / ‚úì‚úó / Richtig</p>
          </div>
        </div>

        <div class="historyWrap">
          <table aria-label="Antworten Tabelle">
            <thead>
              <tr>
                <th>Du hast</th>
                <th class="status">‚úì/‚úó</th>
                <th>Richtig</th>
              </tr>
            </thead>
            <tbody id="historyBody">
              <!-- rows inserted by JS -->
            </tbody>
          </table>
        </div>
      </section>
    </div>

    <footer>
      by Marco P // Ver. 1.5 // 2026
    </footer>
  </div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTLMG3zUFzaLSA82QS7T4E8IAHiung0H2LYRU8hoi_svBol2OoFWmTFBhGVhCPxK2xGtADv1sM9guDr/pub?output=csv";

    let data = [];
    let current = 0;
    let correct = 0;
    let wrong = 0;

    // Auto-next timer (2 seconds)
    const AUTO_SECONDS = 2;
    let autoEnabled = true;
    let countdownTimer = null;
    let remaining = 0;

    async function loadCSV() {
      const res = await fetch(csvUrl + '&t=' + new Date().getTime());
      const text = await res.text();
      const lines = text.trim().split("\n").slice(1);

      data = lines.map(line => {
        const [article, word, plural, example, italian] = line.split(",");
        return {
          article: article?.trim(),
          word: word?.trim(),
          plural: plural?.trim(),
          example: example?.trim(),
          italian: italian?.trim()
        };
      });

      shuffle(data);
      current = 0;
      updateScore();
      loadQuestion();
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function updateScore() {
      const total = correct + wrong;
      const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
      document.getElementById("score").textContent =
        `‚úÖ Richtig: ${correct}‚ÄÉ‚ùå Falsch: ${wrong}‚ÄÉüìä ${percentage}% korrekt`;
    }

    function setCountdownText(text) {
      document.getElementById("countdown").textContent = text || "";
    }

    function clearCountdown() {
      if (countdownTimer) {
        clearInterval(countdownTimer);
        countdownTimer = null;
      }
      remaining = 0;
      setCountdownText("");
    }

    function startCountdownThenNext() {
      clearCountdown();
      remaining = AUTO_SECONDS;

      // If paused, do nothing
      if (!autoEnabled) {
        setCountdownText("Pausiert");
        return;
      }

      setCountdownText(`N√§chstes Wort in ${remaining}‚Ä¶`);

      countdownTimer = setInterval(() => {
        // If paused mid-countdown, stop and show paused
        if (!autoEnabled) {
          clearInterval(countdownTimer);
          countdownTimer = null;
          setCountdownText("Pausiert");
          return;
        }

        remaining -= 1;

        if (remaining > 0) {
          setCountdownText(`N√§chstes Wort in ${remaining}‚Ä¶`);
        } else {
          clearCountdown();
          nextQuestion();
        }
      }, 1000);
    }

    function nextQuestion() {
      current = (current + 1) % data.length;
      loadQuestion();
    }

    function addHistoryRow(chosenArticle, word, isCorrect, correctArticle) {
      const tbody = document.getElementById("historyBody");

      const tr = document.createElement("tr");

      const tdChosen = document.createElement("td");
      tdChosen.textContent = `${chosenArticle} ${word}`;

      const tdStatus = document.createElement("td");
      tdStatus.className = "status " + (isCorrect ? "ok" : "bad");
      tdStatus.textContent = isCorrect ? "‚úì" : "‚úó";

      const tdRight = document.createElement("td");
      if (isCorrect) {
        tdRight.textContent = "‚Äî";
        tdRight.className = "mutedCell";
      } else {
        tdRight.textContent = `${correctArticle} ${word}`;
      }

      tr.appendChild(tdChosen);
      tr.appendChild(tdStatus);
      tr.appendChild(tdRight);

      // Add on top (newest first)
      tbody.prepend(tr);

      // Optional: limit rows to keep it tidy
      const MAX_ROWS = 200;
      while (tbody.children.length > MAX_ROWS) {
        tbody.removeChild(tbody.lastChild);
      }
    }

    function loadQuestion() {
      if (!data.length) return;

      clearCountdown();

      const item = data[current];
      document.getElementById("word").textContent = `${item.word}`;

      const options = ["der", "die", "das"];
      const optionsDiv = document.getElementById("options");
      const resultDiv = document.getElementById("result");
      const extraDiv = document.getElementById("extra");

      optionsDiv.innerHTML = "";
      resultDiv.textContent = "";
      extraDiv.innerHTML = "";

      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;

        btn.onclick = () => {
          // disable all buttons after one click
          Array.from(optionsDiv.querySelectorAll("button")).forEach(b => b.disabled = true);

          const isCorrect = (opt === item.article);

          if (isCorrect) {
            correct++;
            resultDiv.textContent = "‚úÖ Richtig!";
          } else {
            wrong++;
            resultDiv.textContent = `‚ùå Falsch! Richtiger Artikel: "${item.article}"`;
          }

          extraDiv.innerHTML =
            `<strong>Plural:</strong> ${item.plural}<br>` +
            `<strong>Beispiel:</strong> ${item.example}<br>` +
            `<strong>Italienisch:</strong> ${item.italian}`;

          updateScore();
          addHistoryRow(opt, item.word, isCorrect, item.article);

          // auto next with countdown
          startCountdownThenNext();
        };

        optionsDiv.appendChild(btn);
      });
    }

    // Reset button
    document.getElementById("resetBtn").onclick = () => {
      correct = 0;
      wrong = 0;
      current = 0;

      // fresh order
      shuffle(data);

      // clear UI
      document.getElementById("result").textContent = "";
      document.getElementById("extra").innerHTML = "";
      document.getElementById("historyBody").innerHTML = "";
      clearCountdown();

      updateScore();
      loadQuestion();
    };

    // Pause toggle
    document.getElementById("pauseBtn").onclick = () => {
      autoEnabled = !autoEnabled;

      const btn = document.getElementById("pauseBtn");
      btn.textContent = autoEnabled ? "Pause" : "Weiter";

      // If enabling again and there is remaining time, resume countdown
      if (autoEnabled) {
        // If the user already answered and countdown was paused, continue
        if (remaining > 0) {
          startCountdownThenNext();
        } else {
          setCountdownText("");
        }
      } else {
        // Pause
        setCountdownText("Pausiert");
      }
    };

    // Start
    updateScore();
    loadCSV();

    // Splash hide
    setTimeout(() => {
      const splash = document.getElementById("splash");
      if (splash) splash.style.display = "none";
    }, 1200);
  </script>
</body>
</html>

