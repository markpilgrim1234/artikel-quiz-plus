



<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DeutschBuddy ‚Äì Welcher Artikel?</title>

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" href="icon.png">
  <meta name="theme-color" content="#ffffff">

  <style>
    :root{
      --der: #000000;
      --die: #e94e3c;
      --das: #f4c542;

      --bg: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --card: #ffffff;
      --border: #e5e7eb;
      --shadow: 0 10px 25px rgba(0,0,0,0.06);
      --radius: 14px;

      --donate: #169BD7;
      --donateHover: #1287BC;

      --resetBg: #f3f4f6;
      --resetHover: #e5e7eb;
    }

    *{ box-sizing: border-box; }

    body{
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.55;
      overflow-x: hidden;
    }

    header{
      position: sticky;
      top: 0;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
      z-index: 20;
    }

    .topbar{
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .brand a{
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
      text-decoration: none;
      color: inherit;
    }

    .brand img{
      width: 34px;
      height: 34px;
      border-radius: 10px;
    }

    .titles{
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .titles h1{
      margin: 0;
      font-size: 1.05rem;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .titles p{
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      text-decoration: none;
      font-weight: 700;
      cursor: pointer;
      transition: transform .05s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.04);
      white-space: nowrap;
    }
    .btn:active{ transform: translateY(1px); }
    .btn:hover{
      border-color: #d1d5db;
      background: #fafafa;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    .btnDonate{
      background: var(--donate);
      border-color: var(--donate);
      color: #fff;
      box-shadow: 0 6px 18px rgba(22,155,215,0.25);
    }
    .btnDonate:hover{
      background: var(--donateHover);
      border-color: var(--donateHover);
    }

    .btnSmall{
      padding: 7px 10px;
      font-size: 0.9rem;
      border-radius: 999px;
      box-shadow: none;
    }

    .btnResetSmall{
      background: var(--resetBg);
      border-color: var(--border);
      color: #374151;
    }
    .btnResetSmall:hover{
      background: var(--resetHover);
      border-color: #d1d5db;
      box-shadow: none;
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 16px 28px;
    }

    .grid{
      display: grid;
      gap: 14px;
    }

    @media (min-width: 980px){
      .grid{
        grid-template-columns: 1.25fr 0.9fr;
        align-items: start;
      }
    }

    .hero{
      margin: 18px 0 14px;
      padding: 18px 18px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
      box-shadow: var(--shadow);
    }
    .heroTitle{
      margin: 0 0 6px;
      font-size: 1.35rem;
      letter-spacing: 0.2px;
      font-weight: 900;
    }
    .heroSub{
      margin: 0;
      color: var(--muted);
      font-size: 1rem;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .cardHead{
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .cardHeadLeft{
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .cardHeadLeft .title{
      margin: 0;
      font-size: 1.05rem;
      font-weight: 800;
      color: var(--text);
    }

    .cardHeadLeft .subtitle{
      margin: 0;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .scoreRow{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.04);
    }

    #score{
      font-weight: 800;
      font-size: 0.98rem;
      color: #333;
      white-space: nowrap;
    }

    .content{
      padding: 16px;
    }

    .word{
      font-size: 2.2rem;
      text-align: center;
      font-weight: 900;
      margin: 10px 0 14px;
      letter-spacing: 0.2px;
    }

    .options{
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 6px;
    }

    .options button{
      flex: 1;
      padding: 1.1rem;
      font-size: 1.5rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: #fff;
      font-weight: 900;
      box-shadow: 0 10px 18px rgba(0,0,0,0.08);
      transition: transform .05s ease, filter .2s ease, opacity .2s ease;
    }
    .options button:active{ transform: translateY(1px); }
    .options button:hover{ filter: brightness(0.98); }

    .options button:nth-child(1){ background: var(--der); }
    .options button:nth-child(2){ background: var(--die); }
    .options button:nth-child(3){ background: var(--das); color: #111; }

    .options button:disabled{
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .result{
      margin-top: 14px;
      font-weight: 900;
      text-align: center;
      font-size: 1.25rem;
      min-height: 1.6em;
    }

    .extra{
      margin-top: 10px;
      padding: 12px;
      border-radius: 12px;
      border: 1px dashed #d1d5db;
      background: #fbfbfb;
      text-align: center;
      color: #374151;
      font-size: 1.05rem;
      min-height: 1.2em;
    }

    .countdownRow{
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      min-height: 40px;
      flex-wrap: wrap;
    }

    #countdown{
      font-weight: 800;
      color: var(--muted);
      font-size: 0.95rem;
      text-align: center;
      white-space: nowrap;
    }

    /* History table */
    .historyWrap{
      max-height: 520px;
      overflow: auto;
      padding: 0 16px 16px;
    }

    table{
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }
    th, td{
      padding: 10px 8px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }
    th{
      text-align: left;
      color: #374151;
      font-weight: 900;
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 2;
    }
    td.status{
      width: 56px;
      text-align: center;
      font-weight: 900;
      white-space: nowrap;
    }
    .ok{ color: #0f766e; }
    .bad{ color: #b91c1c; }
    .mutedCell{ color: var(--muted); }

    /* Donate line + small donate button */
    .donateBar{
      margin-top: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: 0.95rem;
      text-align: center;
    }

    /* Splash */
    #splash{
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #splash h1{
      font-size: 2rem;
      margin: 0 0 1rem;
    }
    #splash img{
      width: 260px;
      height: 260px;
    }

    footer{
      margin-top: 18px;
      text-align: center;
      color: #888;
      font-size: 0.85rem;
    }
    .footerRow{
      display: inline-flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }
  </style>
</head>

<body>
  <!-- Splash -->
  <div id="splash" aria-label="Ladebildschirm">
    <h1>Welcher Artikel?</h1>
    <img src="icon.png" alt="DeutschBuddy Logo">
  </div>

  <!-- Top bar -->
  <header>
    <div class="topbar">
      <div class="brand">
        <a href="index.html" aria-label="Zur Startseite">
          <img src="icon.png" alt="DeutschBuddy Logo">
          <div class="titles">
            <h1>DeutschBuddy</h1>
            <p>Welcher Artikel?</p>
          </div>
        </a>
      </div>

      <div style="display:flex; gap:10px; align-items:center;">
        <a class="btn" href="index.html" aria-label="Zur Startseite">Start</a>
        <a class="btn" href="artikelregeln.html" aria-label="Artikelregeln √∂ffnen">Regeln</a>
      </div>
    </div>
  </header>

  <div class="wrap">
    <section class="hero">
      <h2 class="heroTitle">W√§hle den richtigen Artikel.</h2>
      <p class="heroSub">
        Tippe auf <strong>der</strong>, <strong>die</strong> oder <strong>das</strong>.
        Danach geht es automatisch weiter (3 Sekunden).
      </p>
    </section>

    <div class="grid">
      <!-- LEFT: Quiz -->
      <section class="card">
        <div class="cardHead">
          <div class="cardHeadLeft">
            <p class="title">Spiel</p>
            <p class="subtitle">Trainiere der / die / das</p>
          </div>

          <div class="scoreRow" aria-label="Punktestand">
            <div id="score">‚úÖ Richtig: 0‚ÄÉ‚ùå Falsch: 0</div>
          </div>
        </div>

        <div class="content">
          <div class="word" id="word">Lade W√∂rter...</div>

          <div class="options" id="options"></div>

          <div class="result" id="result" aria-live="polite"></div>

          <div class="extra" id="extra" aria-live="polite"></div>

          <div class="countdownRow">
            <div id="countdown"></div>
            <button id="pauseBtn" class="btn btnSmall" type="button">Pause</button>
            <button id="resetBtn" class="btn btnSmall btnResetSmall" type="button" title="Reset">Reset</button>
          </div>
        </div>
      </section>

      <!-- RIGHT: History -->
      <section class="card">
        <div class="cardHead">
          <div class="cardHeadLeft">
            <p class="title">Antworten</p>
            <p class="subtitle">Deine Antwort / Ergebnis / Richtig w√§re</p>
          </div>
        </div>

        <div class="historyWrap">
          <table aria-label="Antworten Tabelle">
            <thead>
              <tr>
                <th>Deine Antwort</th>
                <th class="status">Ergebnis</th>
                <th>Richtig w√§re</th>
              </tr>
            </thead>
            <tbody id="historyBody"></tbody>
          </table>
        </div>
      </section>
    </div>

    <!-- Support -->
    <div class="donateBar">
      <span>Gef√§llt dir das Quiz? Unterst√ºtze das Projekt, damit neue Updates m√∂glich sind. Danke!</span>
      <a class="btn btnDonate btnSmall"
         href="https://www.paypal.com/donate/?hosted_button_id=5HNZSM7VZTNA6"
         target="_blank" rel="noopener noreferrer">
        Projekt unterst√ºtzen / Donate
      </a>
    </div>

    <footer>
      <div class="footerRow">
        <span>by Marco P // Ver. 1.7 // 2026</span>
        <a class="btn btnSmall" href="ueber-mich.html" aria-label="√úber mich">√úber mich</a>
      </div>
    </footer>
  </div>

  <script>
    // TIP: Use TSV to avoid bugs with commas inside text (examples often contain commas).
    const dataUrl =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTLMG3zUFzaLSA82QS7T4E8IAHiung0H2LYRU8hoi_svBol2OoFWmTFBhGVhCPxK2xGtADv1sM9guDr/pub?output=tsv";

    let data = [];
    let current = 0;
    let correct = 0;
    let wrong = 0;

    const AUTO_SECONDS = 3;
    let autoEnabled = true;
    let countdownTimer = null;
    let remaining = 0;

    function safeText(v) {
      return (v ?? "").toString().trim();
    }

    async function loadData() {
      try {
        const res = await fetch(dataUrl + "&t=" + Date.now());
        if (!res.ok) throw new Error("HTTP " + res.status);
        const text = await res.text();

        const lines = text.trim().split("\n").slice(1);
        data = lines
          .map(line => line.split("\t"))
          .map(cols => {
            const [article, word, plural, example, italian] = cols;
            return {
              article: safeText(article),
              word: safeText(word),
              plural: safeText(plural),
              example: safeText(example),
              italian: safeText(italian)
            };
          })
          .filter(item => item.word && item.article);

        shuffle(data);
        current = 0;
        updateScore();
        loadQuestion();
      } catch (e) {
        document.getElementById("word").textContent = "Fehler beim Laden üòï";
        document.getElementById("result").textContent = "Bitte pr√ºfe deine Verbindung und lade die Seite neu.";
        console.error(e);
      }
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function updateScore() {
      const total = correct + wrong;
      const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
      document.getElementById("score").textContent =
        `‚úÖ Richtig: ${correct}‚ÄÉ‚ùå Falsch: ${wrong}‚ÄÉüìä ${percentage}% korrekt`;
    }

    function setCountdownText(text) {
      document.getElementById("countdown").textContent = text || "";
    }

    function clearCountdown(keepRemaining = false) {
      if (countdownTimer) {
        clearInterval(countdownTimer);
        countdownTimer = null;
      }
      if (!keepRemaining) remaining = 0;
      if (!keepRemaining) setCountdownText("");
    }

    function nextQuestion() {
      if (!data.length) return;
      current = (current + 1) % data.length;
      loadQuestion();
    }

    function startCountdown(seconds) {
      clearCountdown(false);
      remaining = seconds;

      if (!autoEnabled) {
        setCountdownText("Pausiert");
        return;
      }

      setCountdownText(`N√§chstes Wort in ${remaining}‚Ä¶`);

      countdownTimer = setInterval(() => {
        if (!autoEnabled) {
          clearCountdown(true);
          setCountdownText("Pausiert");
          return;
        }

        remaining -= 1;

        if (remaining > 0) {
          setCountdownText(`N√§chstes Wort in ${remaining}‚Ä¶`);
        } else {
          clearCountdown(false);
          nextQuestion();
        }
      }, 1000);
    }

    function startCountdownThenNext() {
      startCountdown(AUTO_SECONDS);
    }

    function addHistoryRow(chosenArticle, word, isCorrect, correctArticle) {
      const tbody = document.getElementById("historyBody");

      const tr = document.createElement("tr");

      const tdChosen = document.createElement("td");
      tdChosen.textContent = `${chosenArticle} ${word}`;

      const tdStatus = document.createElement("td");
      tdStatus.className = "status " + (isCorrect ? "ok" : "bad");
      tdStatus.textContent = isCorrect ? "‚úì" : "‚úó";

      const tdRight = document.createElement("td");
      if (isCorrect) {
        tdRight.textContent = "‚Äî";
        tdRight.className = "mutedCell";
      } else {
        tdRight.textContent = `${correctArticle} ${word}`;
      }

      tr.appendChild(tdChosen);
      tr.appendChild(tdStatus);
      tr.appendChild(tdRight);

      tbody.prepend(tr);

      const MAX_ROWS = 200;
      while (tbody.children.length > MAX_ROWS) {
        tbody.removeChild(tbody.lastChild);
      }
    }

    function renderExtra(item) {
      const extra = document.getElementById("extra");
      extra.innerHTML = ""; // clear safely

      const rows = [
        ["Plural:", item.plural],
        ["Beispiel:", item.example],
        ["Italienisch:", item.italian],
      ];

      rows.forEach(([label, value]) => {
        const line = document.createElement("div");
        const strong = document.createElement("strong");
        strong.textContent = label + " ";
        line.appendChild(strong);
        line.appendChild(document.createTextNode(value || "‚Äî"));
        extra.appendChild(line);
      });
    }

    function loadQuestion() {
      if (!data.length) return;

      clearCountdown(false);

      const item = data[current];
      document.getElementById("word").textContent = item.word || "‚Äî";

      const options = ["der", "die", "das"];
      const optionsDiv = document.getElementById("options");
      const resultDiv = document.getElementById("result");

      optionsDiv.innerHTML = "";
      resultDiv.textContent = "";
      document.getElementById("extra").textContent = "";
      setCountdownText("");

      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;

        btn.onclick = () => {
          Array.from(optionsDiv.querySelectorAll("button")).forEach(b => b.disabled = true);

          const isCorrect = (opt === item.article);

          if (isCorrect) {
            correct++;
            resultDiv.textContent = "‚úÖ Richtig!";
            if (navigator.vibrate) navigator.vibrate(10);
          } else {
            wrong++;
            resultDiv.textContent = `‚ùå Falsch! Richtiger Artikel: "${item.article}"`;
            if (navigator.vibrate) navigator.vibrate([30, 20, 30]);
          }

          renderExtra(item);
          updateScore();
          addHistoryRow(opt, item.word, isCorrect, item.article);

          startCountdownThenNext();
        };

        optionsDiv.appendChild(btn);
      });
    }

    // Reset
    document.getElementById("resetBtn").onclick = () => {
      correct = 0;
      wrong = 0;
      current = 0;

      shuffle(data);

      document.getElementById("result").textContent = "";
      document.getElementById("extra").textContent = "";
      document.getElementById("historyBody").innerHTML = "";
      clearCountdown(false);

      updateScore();
      loadQuestion();
    };

    // Pause toggle
    document.getElementById("pauseBtn").onclick = () => {
      autoEnabled = !autoEnabled;

      const btn = document.getElementById("pauseBtn");
      btn.textContent = autoEnabled ? "Pause" : "Weiter";

      if (!autoEnabled) {
        if (countdownTimer) {
          clearInterval(countdownTimer);
          countdownTimer = null;
        }
        setCountdownText("Pausiert");
        return;
      }

      if (remaining > 0) {
        startCountdown(remaining);
      } else {
        setCountdownText("");
      }
    };

    // Start
    updateScore();
    loadData();

    // Splash hide
    setTimeout(() => {
      const splash = document.getElementById("splash");
      if (splash) splash.style.display = "none";
    }, 1000);
  </script>
</body>
</html>
